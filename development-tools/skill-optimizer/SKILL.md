---
name: skill-optimizer
description: スキルの重複検出、統合、分割を行い、スキルリポジトリを最適化する。既存スキルの分析、重複の特定、統合・分割の提案、品質チェックを実施したい場合に使用。Taskエージェントを活用して意味的な類似性を判断。
---

# スキル最適化ツール

このスキルは、スキルリポジトリの管理と最適化を支援します。**Taskエージェントを活用**して重複の検出、スキルの統合・分割提案、品質チェックを提供し、スキルリポジトリを効率的に保ちます。

## 目的

このスキルは以下を提供します：

1. **意味的な重複検出** - Taskエージェントを使って類似スキルを意味的に判断
2. **統合提案** - 重複スキルを効率的に統合する方法を提案
3. **分割提案** - 大きすぎる、または複数の責任を持つスキルを適切に分割
4. **品質チェック** - スキルの構造、ドキュメント、命名規則の検証
5. **最適化推奨** - リポジトリ全体の構造改善の提案

## なぜエージェントベース？

**Pythonスクリプトの限界：**
- 文字列の単純比較では「データ分析」≠「データ解析」と判定
- 日本語の意味やニュアンスを理解できない
- スキルの目的や文脈を考慮できない

**Taskエージェントの利点：**
- 意味的類似性を正確に判断（「分析」と「解析」は同じと理解）
- スキルの目的や使用場面を文脈で理解
- 「完全重複」「部分重複」「補完的」を適切に分類
- 日本語のニュアンスと専門用語を理解

## いつ使用するか

以下の場合にこのスキルを使用：

- スキルリポジトリに重複が存在する疑いがある
- 多数のスキルが追加され、整理が必要
- スキルの品質や一貫性を確保したい
- スキルの統合または分割の判断が必要
- リポジトリ全体の構造を最適化したい

## 使用方法

### ステップ1: スキルデータの収集

まず、`scripts/analyze_skills.py`でスキル情報を収集：

```bash
python3 scripts/analyze_skills.py . --output /tmp/skills.json --pretty
```

このスクリプトは以下の情報を収集：

- スキル名、説明、カテゴリ
- 本文のプレビュー（最初の500文字）
- セクションヘッダー
- 単語数
- バンドルリソース（scripts, references, assetsなど）

**重要**: このスクリプトは類似度を計算しません。データ収集のみを行います。

### ステップ2: Taskエージェントで重複分析

収集したデータをもとに、Taskエージェントを起動して重複を分析：

```
Taskエージェントに以下を依頼：

「/tmp/skills.json を読み込み、以下の基準でスキルの重複を分析してください：

1. 意味的に類似したスキルのペアを特定
2. 各ペアを以下に分類：
   - 完全重複（ほぼ同一の目的・機能）
   - 部分重複（一部の機能が重複）
   - 補完的（関連するが異なる側面）

3. 各ペアについて：
   - 類似している理由を説明
   - 統合すべきか、分離すべきかを判断
   - 統合する場合の戦略を提案

特に以下を考慮：
- スキル名と説明の意味的類似性
- 使用場面の重複
- 機能の重複度合い
- カテゴリの適切性

レポート形式で結果を提示してください。」
```

Taskツールの使用例：

```
Task(
  subagent_type="general-purpose",
  description="Analyze skills for duplicates",
  prompt="上記のプロンプト内容"
)
```

### ステップ3: エージェント結果の解釈

Taskエージェントが返すレポートには以下が含まれます：

- **高類似度ペア**: 統合を強く推奨
- **中類似度ペア**: 統合を検討
- **低類似度ペア**: クロスリファレンスで十分

各ペアについて、エージェントは以下を提供：

1. 類似性の理由（意味的分析）
2. 統合の推奨度
3. 統合戦略（吸収、マージ、階層化）

### ステップ4: 大きなスキルの検出

単語数が多いスキル（>3000語）を特定：

```bash
python3 scripts/analyze_skills.py . --pretty | jq '.skills[] | select(.word_count > 3000) | {name, word_count, category}'
```

または、Taskエージェントに依頼：

```
「/tmp/skills.json から単語数が3000以上のスキルを特定し、
それぞれについて分割の必要性を判断してください。

判断基準：
- 複数の独立した責任を持つか
- 異なるユースケースが混在するか
- セクションが機能的に分離可能か

分割が必要な場合、新しいスキル名と責任範囲を提案してください。」
```

### ステップ5: 統合の実行

エージェントの推奨に基づいて統合を実行する場合：

1. **統合候補の評価**:
   - エージェントの分析を確認
   - どちらのスキルがより包括的かを判断
   - どちらがより良いドキュメントを持つかを確認

2. **統合戦略の選択**:
   - **吸収**: 小さいスキルを大きいスキルに統合
   - **マージ**: 両方のベスト部分を組み合わせて新しいスキルを作成
   - **階層化**: 汎用スキルと専門スキルに分割

3. **統合の実装**:
   - マージするコンテンツを特定
   - 新しいSKILL.mdを作成
   - バンドルリソースを統合
   - 旧スキルを削除またはアーカイブ

### ステップ6: 分割の実行

大きなスキルを分割する場合：

1. **分割ポイントの決定**:
   - エージェントの提案を確認
   - 機能的に独立したセクションを特定
   - 各セクションが独立したスキルとして成立するか確認

2. **分割の実装**:
   - 新しいスキルディレクトリを作成
   - コンテンツを分割
   - バンドルリソースを適切に配分
   - 各スキルにクロスリファレンスを追加

### ステップ7: 構造的品質チェック

`scripts/check_quality.py`で構造的な品質を検証：

```bash
python3 scripts/check_quality.py .
```

このスクリプトは以下をチェック：

1. **構造の検証**:
   - YAMLフロントマターの存在と形式
   - 必須フィールド（name、description）の確認
   - ディレクトリ構造の標準への準拠
     - 標準的なディレクトリ: `scripts/`, `references/`, `assets/`, `templates/`, `examples/`
     - 標準的なファイル: `examples.md`, `reference.md`
     - すべてのリソースはオプションだが、存在する場合は標準的な名前を使用

2. **ドキュメントの品質**:
   - 説明の明確性と具体性
   - 手順の完全性
   - 例の存在

3. **命名規則**:
   - スキル名の一貫性
   - ディレクトリ名とスキル名の一致
   - 適切なケバブケースの使用

4. **参照の整合性**:
   - SKILL.md内で参照されるファイルの存在
   - バンドルリソースの適切な配置

### ステップ8: 最適化推奨の生成

Taskエージェントに全体的な最適化を依頼：

```
「/tmp/skills.json を分析し、リポジトリ全体の最適化推奨を生成してください：

1. カテゴリ構造の改善
   - 新しいカテゴリの提案
   - スキルの再配置
   - カテゴリ階層の最適化

2. スキル間の関係性
   - クロスリファレンスの機会
   - スキルチェーンの最適化
   - ラーニングパスの改善

3. ドキュメントの一貫性
   - 命名規則の統一
   - 説明スタイルの一貫性
   - 構造パターンの標準化」
```

### ステップ9: 実装と検証

最適化を実装する際：

1. **変更の優先順位付け**:
   - 影響度の高い変更から実施
   - 低リスクの変更を先行

2. **段階的な実装**:
   - 一度に1つの統合/分割を実行
   - 各変更後にテスト
   - check_quality.pyで検証

3. **ドキュメントの更新**:
   - READMEファイルを更新
   - クロスリファレンスを追加
   - 変更ログを記録

4. **最終検証**:
   - リンターを実行（markdownlint、yamllint）
   - 構造検証スクリプトを実行
   - 手動レビュー

## ワークフロー例

完全なワークフロー例：

```bash
# 1. データ収集
python3 development-tools/skill-optimizer/scripts/analyze_skills.py . \
  --output /tmp/skills.json --pretty

# 2. サマリーを確認
python3 development-tools/skill-optimizer/scripts/analyze_skills.py . --summary-only

# 3. 構造的品質チェック
python3 development-tools/skill-optimizer/scripts/check_quality.py .
```

その後、Taskエージェントに依頼：

```
1. 重複分析を実行
2. 大きなスキルの分割提案
3. 全体的な最適化推奨
```

## ベストプラクティス

1. **エージェント活用**: 意味的判断はTaskエージェントに任せる
2. **慎重な判断**: 統合/分割の決定前に十分な分析を実施
3. **ユーザー影響の考慮**: 既存ユーザーへの影響を最小化
4. **段階的な変更**: 大規模な変更は段階的に実施
5. **ドキュメント重視**: すべての変更を適切に文書化
6. **テストの徹底**: 変更後の検証を怠らない
7. **人間の最終判断**: エージェントの提案は参考にするが、最終判断は人間が行う

## スクリプトリファレンス

### analyze_skills.py

データ収集専用スクリプト（類似度計算なし）。

**基本的な使用：**
```bash
# JSON出力（標準出力）
python3 scripts/analyze_skills.py .

# ファイルに保存（整形付き）
python3 scripts/analyze_skills.py . --output skills.json --pretty

# サマリーのみ
python3 scripts/analyze_skills.py . --summary-only
```

**出力形式：**
```json
{
  "base_path": ".",
  "stats": {
    "total_skills": 172,
    "total_categories": 16,
    "skills_with_errors": 0,
    "average_word_count": 850
  },
  "skills": [
    {
      "name": "skill-name",
      "description": "...",
      "category": "category-name",
      "word_count": 1200,
      "content_preview": "...",
      "headers": ["セクション1", "セクション2"],
      "resources": {
        "scripts": ["script1.py"],
        "references": []
      }
    }
  ]
}
```

### check_quality.py

構造的品質チェックスクリプト。

**使用方法：**
```bash
# 全スキルをチェック
python3 scripts/check_quality.py .

# 特定のカテゴリのみ
python3 scripts/check_quality.py development-tools
```

**チェック項目：**
- YAMLフロントマターの妥当性
- ファイル構造の標準準拠
- リソース参照の整合性
- 命名規則の遵守

## 注意事項

- Taskエージェントの分析は完璧ではなく、最終判断は人間が行う
- スキルの使用頻度や重要度も考慮する
- 変更前にバックアップを取る
- 大規模な変更は段階的に実施する
- エージェントの提案を鵜呑みにせず、批判的に評価する
