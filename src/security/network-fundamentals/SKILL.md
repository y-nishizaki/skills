---
name: "network-fundamentals"
description: >
  ネットワークセキュリティの基礎知識を提供します。TCP/IP、DNS、HTTP/HTTPS、VPN、Firewall、Proxy、
  OSI参照モデルの各層でのセキュリティ脆弱性の理解と分析、ネットワークプロトコルのセキュリティ設計を
  支援する際に使用します。
  キーワード - ネットワーク、TCP/IP、DNS、HTTP、HTTPS、VPN、ファイアウォール、プロキシ、OSI、
  プロトコル、セキュリティ。
version: 1.0.0
---

# ネットワーク基礎セキュリティスキル

## 目的

このスキルは、ネットワークセキュリティの基礎となる知識と実践的なガイダンスを提供します。
ネットワークプロトコル、アーキテクチャ、セキュリティメカニズムの理解を通じて、
安全なネットワーク設計、脆弱性分析、セキュリティ対策の実装を支援します。

## このスキルを使用する場合

以下の場合にこのスキルを使用します:

- ユーザーがネットワークプロトコル（TCP/IP、DNS、HTTP/HTTPSなど）のセキュリティ分析を求めた場合
- ユーザーがネットワークアーキテクチャのセキュリティ設計を必要とする場合
- ユーザーがファイアウォール、VPN、プロキシなどのセキュリティ機能を実装したい場合
- ユーザーがOSI参照モデルの各層での脆弱性を理解したい場合
- ユーザーがネットワークトラフィックの分析やパケットキャプチャを行う場合
- ユーザーが「ネットワークセキュリティ」、「プロトコル」、「ファイアウォール」と言及した場合

## ネットワークセキュリティの基礎

### OSI参照モデルとセキュリティ

OSI（Open Systems Interconnection）参照モデルの7層構造において、各層で異なるセキュリティ脅威と対策が存在します。

#### レイヤー1: 物理層（Physical Layer）

**主な脅威:**
- 物理的な盗聴（wiretapping）
- ケーブルの切断や損傷
- 電磁波の傍受（TEMPEST攻撃）
- 不正な物理アクセス

**セキュリティ対策:**
- 物理的なアクセス制御（施錠、監視カメラ）
- ケーブルの暗号化（光ファイバーの使用）
- 電磁シールド
- 冗長化による可用性確保

#### レイヤー2: データリンク層（Data Link Layer）

**主な脅威:**
- MACアドレススプーフィング
- ARPスプーフィング/ARPポイズニング
- VLANホッピング
- スイッチのCAMテーブル溢れ攻撃

**セキュリティ対策:**
- MACアドレスフィルタリング
- ポートセキュリティの設定
- Dynamic ARP Inspection (DAI)
- Private VLAN設定
- 802.1X認証

#### レイヤー3: ネットワーク層（Network Layer）

**主な脅威:**
- IPスプーフィング
- ICMPフラッド攻撃
- ルーティングテーブルの改ざん
- Smurf攻撃
- IPフラグメンテーション攻撃

**セキュリティ対策:**
- IPsec（IP Security）の実装
- ルーターのアクセス制御リスト（ACL）
- 逆引き検証（Reverse Path Forwarding）
- ファイアウォールによるパケットフィルタリング
- ルーティングプロトコルの認証

#### レイヤー4: トランスポート層（Transport Layer）

**主な脅威:**
- SYNフラッド攻撃
- TCPセッションハイジャック
- ポートスキャン
- UDPフラッド攻撃
- シーケンス番号予測攻撃

**セキュリティ対策:**
- SYN Cookie
- ステートフルファイアウォール
- ポートノッキング
- TLS/SSL暗号化
- レート制限

#### レイヤー5-7: セッション層、プレゼンテーション層、アプリケーション層

**主な脅威:**
- SQLインジェクション
- クロスサイトスクリプティング（XSS）
- DNSスプーフィング/キャッシュポイズニング
- HTTPリクエストスマグリング
- アプリケーション層DDoS攻撃

**セキュリティ対策:**
- アプリケーションファイアウォール（WAF）
- DNSSEC
- 入力検証とサニタイゼーション
- HTTPS/TLS暗号化
- レート制限とトラフィックシェーピング

## 主要プロトコルのセキュリティ

### TCP/IP

**セキュリティ考慮事項:**

1. **3ウェイハンドシェイクの保護**
   - SYNフラッド攻撃への対策
   - 初期シーケンス番号のランダム化
   - タイムアウト設定の最適化

2. **接続状態の管理**
   - ステートフルインスペクション
   - 不正なパケットの検出と破棄
   - コネクショントラッキング

3. **パケットフィルタリング**
   - 送信元/宛先IPアドレスの検証
   - ポート番号による制御
   - フラグメント化されたパケットの処理

### DNS（Domain Name System）

**セキュリティ脅威:**
- DNSキャッシュポイズニング
- DNSスプーフィング
- DGAマルウェアによるC&C通信
- DNSトンネリング
- DNSアンプ攻撃

**セキュリティ対策:**

1. **DNSSEC（DNS Security Extensions）の実装**
   - デジタル署名による応答の検証
   - チェーンオブトラストの確立
   - 中間者攻撃の防止

2. **DNSサーバーの保護**
   - 再帰クエリの制限
   - レート制限の設定
   - ソースポートのランダム化
   - 分離されたDNSサーバー（権威/リカーシブ）

3. **DNSモニタリング**
   - 異常なクエリパターンの検出
   - DGAドメインの識別
   - トンネリングの検出

### HTTP/HTTPS

**HTTP脆弱性:**
- 平文通信による盗聴
- セッションハイジャック
- 中間者攻撃
- クッキーの盗用

**HTTPS/TLSによる保護:**

1. **暗号化の実装**
   - TLS 1.2以上の使用（TLS 1.0/1.1は非推奨）
   - 強力な暗号スイートの選択
   - Perfect Forward Secrecy (PFS)の有効化

2. **証明書管理**
   - 信頼できるCA（認証局）からの証明書取得
   - 証明書の有効期限管理
   - OCSP Stapling
   - Certificate Transparency

3. **HTTPセキュリティヘッダー**
   - Strict-Transport-Security (HSTS)
   - Content-Security-Policy (CSP)
   - X-Frame-Options
   - X-Content-Type-Options
   - Referrer-Policy

4. **プロトコルの最新化**
   - HTTP/2またはHTTP/3の採用
   - 0-RTT接続の適切な実装
   - TLS 1.3の利用

### VPN（Virtual Private Network）

**VPNタイプ:**

1. **IPsec VPN**
   - Site-to-Site VPN
   - Remote Access VPN
   - AH（Authentication Header）とESP（Encapsulating Security Payload）
   - IKE（Internet Key Exchange）による鍵交換

2. **SSL/TLS VPN**
   - ブラウザベースのアクセス
   - クライアントレスまたはクライアントベース
   - アプリケーション層での保護

3. **WireGuard**
   - 最新の暗号プロトコル
   - シンプルな設定
   - 高性能

**VPNセキュリティのベストプラクティス:**
- 強力な認証（多要素認証）
- 最新の暗号化アルゴリズム
- Split Tunneling の慎重な使用
- VPNログの監視
- 定期的な鍵のローテーション

## ファイアウォール

### ファイアウォールのタイプ

1. **パケットフィルタリングファイアウォール**
   - OSI Layer 3-4で動作
   - IPアドレス、ポート番号、プロトコルによるフィルタリング
   - ステートレス検査

2. **ステートフルインスペクションファイアウォール**
   - コネクション状態の追跡
   - より高度な制御
   - パフォーマンスとセキュリティのバランス

3. **アプリケーションレイヤーファイアウォール（WAF）**
   - OSI Layer 7で動作
   - HTTP/HTTPSトラフィックの詳細検査
   - OWASP Top 10への対策

4. **次世代ファイアウォール（NGFW）**
   - 統合された脅威インテリジェンス
   - IDS/IPS機能
   - アプリケーション認識
   - ディープパケットインスペクション

### ファイアウォールルールの設計原則

1. **最小権限の原則**
   - デフォルト拒否（Deny All）ポリシー
   - 必要な通信のみ許可
   - 定期的なルールレビュー

2. **ゾーンベースのセキュリティ**
   - DMZ（非武装地帯）の設置
   - 内部ネットワークのセグメンテーション
   - トラストゾーンの明確な定義

3. **ログと監視**
   - すべての拒否されたパケットのログ記録
   - 許可されたトラフィックの選択的ログ
   - 異常パターンのアラート

## プロキシサーバー

### プロキシのタイプ

1. **フォワードプロキシ**
   - クライアントの代理として動作
   - コンテンツフィルタリング
   - キャッシング
   - 匿名化

2. **リバースプロキシ**
   - サーバーの代理として動作
   - 負荷分散
   - SSL/TLSオフロード
   - 攻撃からのバックエンド保護

3. **透過プロキシ**
   - クライアント設定不要
   - トラフィックの透明な傍受
   - ポリシー適用

### プロキシセキュリティ機能

- URLフィルタリング
- マルウェアスキャン
- データ損失防止（DLP）
- SSL/TLSインスペクション
- ユーザー認証と認可

## ネットワークトラフィック分析

### パケットキャプチャと分析

**ツール:**
- Wireshark
- tcpdump
- tshark
- Network Miner

**分析手法:**

1. **プロトコル分析**
   - プロトコルの適切な使用確認
   - 異常なプロトコルの検出
   - バージョンの確認

2. **トラフィックパターン分析**
   - ベースラインの確立
   - 異常なトラフィックの検出
   - ボットネット通信の識別

3. **ペイロード検査**
   - 悪意のあるコンテンツの検出
   - データ漏洩の調査
   - 暗号化されていない機密データの特定

### フィルタリングと検索

**Wiresharkディスプレイフィルタの例:**

```
# 特定のIPアドレス
ip.addr == 192.168.1.100

# HTTPトラフィック
http

# TCP SYNパケット
tcp.flags.syn == 1 && tcp.flags.ack == 0

# DNSクエリ
dns.flags.response == 0

# TLS/SSLハンドシェイク
ssl.handshake.type

# 大きなパケット
frame.len > 1500
```

## セキュリティベストプラクティス

### ネットワーク設計

1. **防御の多層化（Defense in Depth）**
   - 複数のセキュリティ層の実装
   - 単一障害点の排除
   - 各層での検証

2. **ネットワークセグメンテーション**
   - VLAN分離
   - マイクロセグメンテーション
   - ゼロトラストネットワーク

3. **アクセス制御**
   - 最小権限の原則
   - 役割ベースのアクセス制御（RBAC）
   - ネットワークアクセス制御（NAC）

### 監視と検出

1. **継続的な監視**
   - ネットワークトラフィックの可視化
   - リアルタイムアラート
   - ベースライン比較

2. **侵入検知/防止システム（IDS/IPS）**
   - シグネチャベース検出
   - 異常検知
   - 自動応答

3. **ログ管理**
   - 集中ログ収集
   - ログの保持と分析
   - 相関分析

### 暗号化

1. **転送中のデータ保護**
   - TLS/SSL for all sensitive communications
   - VPN for remote access
   - IPsec for site-to-site connections

2. **暗号化標準**
   - AES-256 for symmetric encryption
   - RSA-2048 or ECC for asymmetric encryption
   - SHA-256 or better for hashing

3. **鍵管理**
   - 安全な鍵生成
   - 定期的な鍵ローテーション
   - 鍵の安全な保管

## 一般的な攻撃と対策

### DDoS攻撃

**攻撃タイプ:**
- Volumetric attacks（帯域幅消費）
- Protocol attacks（リソース消費）
- Application layer attacks（アプリケーション負荷）

**対策:**
- レート制限
- トラフィックシェーピング
- DDoS保護サービスの利用
- Anycastネットワーク
- ブラックホールルーティング

### Man-in-the-Middle（中間者）攻撃

**攻撃手法:**
- ARPスプーフィング
- DNSスプーフィング
- SSL/TLSストリッピング
- 不正なプロキシ

**対策:**
- エンドツーエンド暗号化
- 証明書ピンニング
- DNSSEC
- HSTS
- 公開鍵インフラストラクチャ（PKI）

### ポートスキャン/ネットワークマッピング

**検出方法:**
- 短期間での多数のポートへの接続試行
- SYNパケットのみのトラフィック
- ICMP/UDPスキャン

**対策:**
- 不要なサービスの無効化
- ポートノッキング
- IDS/IPSによる検出
- ログ監視とアラート

## トラブルシューティングとデバッグ

### ネットワーク診断コマンド

```bash
# 接続性テスト
ping <host>
traceroute <host>  # Linux
tracert <host>     # Windows

# DNSクエリ
nslookup <domain>
dig <domain>
host <domain>

# ポート確認
nc -zv <host> <port>
telnet <host> <port>

# ルーティングテーブル
ip route show      # Linux
route print        # Windows

# ネットワークインターフェース
ip addr show       # Linux
ipconfig /all      # Windows

# アクティブな接続
netstat -an
ss -tuln           # Linux

# パケットキャプチャ
tcpdump -i <interface> -n
tcpdump -i <interface> port <port>
```

### SSL/TLS診断

```bash
# SSL証明書確認
openssl s_client -connect <host>:443 -servername <host>

# 証明書の詳細表示
openssl x509 -in cert.pem -text -noout

# 暗号スイートのテスト
nmap --script ssl-enum-ciphers -p 443 <host>
```

## セキュリティ評価

### ネットワークセキュリティ監査

1. **スコープ定義**
   - 監査対象の特定
   - 目標の設定
   - 許可の取得

2. **情報収集**
   - ネットワークトポロジーの理解
   - デバイスインベントリ
   - 設定の確認

3. **脆弱性スキャン**
   - 自動スキャンツールの使用（Nessus、OpenVAS）
   - 手動検証
   - 誤検知の除外

4. **設定レビュー**
   - ファイアウォールルール
   - ルーター/スイッチ設定
   - セキュリティポリシー

5. **報告と修復**
   - 発見事項の文書化
   - リスク評価
   - 修復推奨事項
   - 再テスト

## 参考リソース

- RFC文書（IETF）
- NIST Cybersecurity Framework
- CIS Controls
- OWASP ネットワークセキュリティガイド
- NSA/CISA セキュリティガイダンス

## 注意事項

- **法的考慮事項**: ネットワークスキャンや侵入テストは、適切な許可を得てのみ実行すること
- **環境への影響**: パケットキャプチャやスキャンが本番環境に与える影響を考慮すること
- **プライバシー**: トラフィック分析時には個人情報保護法規を遵守すること
- **最新情報**: ネットワークセキュリティは急速に進化する分野であり、常に最新情報を確認すること
- **防御専用**: このスキルは防御的なセキュリティ対策のみに使用し、攻撃や不正アクセスには使用しないこと
